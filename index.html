<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤§æ±å·ç·é¸æŒ™ é–‹ç¥¨é€Ÿå ±</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --main-color: #00ff41; --bg-color: #0d0d0d; }
        body { background-color: var(--bg-color); color: var(--main-color); font-family: 'Courier New', monospace; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { border: 2px solid var(--main-color); padding: 20px; width: 90%; max-width: 800px; background: rgba(0, 0, 0, 0.8); box-shadow: 0 0 15px rgba(0, 255, 65, 0.3); }
        h1 { border-bottom: 2px solid var(--main-color); padding-bottom: 10px; }
        canvas { margin-top: 20px; background: #111; padding: 10px; }
        .update-time { font-size: 0.8rem; color: #888; margin-top: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ“Š ç¬¬ä¸€å›å¤§æ±å·ç·é¸æŒ™ é–‹ç¥¨é€Ÿå ±</h1>
    <p>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é›†è¨ˆã‚·ã‚¹ãƒ†ãƒ ç¨¼åƒä¸­</p>
    
    <canvas id="voteChart"></canvas>
    
    <div id="time" class="update-time">æœ€çµ‚æ›´æ–°: èª­ã¿è¾¼ã¿ä¸­...</div>
</div>

<script>
    const GAS_URL = "https://script.google.com/macros/s/AKfycbyfHXAuqwDIQ5Pi65RIvZ9QiAmqWgunOfPQt9lWHrzsfVcCX_BAQS2bSy17QPR6131P/exec"; // æŠ•ç¥¨ã‚µã‚¤ãƒˆã¨åŒã˜URLã§OKï¼

    async function updateChart() {
        try {
            const response = await fetch(GAS_URL);
            const data = await response.json();

            // ãƒ‡ãƒ¼ã‚¿ã®æ•´å½¢ï¼ˆå¾—ç¥¨æ•°é †ã«ä¸¦ã³æ›¿ãˆï¼‰
            const sortedData = Object.entries(data).sort((a, b) => b[1] - a[1]);
            const labels = sortedData.map(item => item[0]);
            const values = sortedData.map(item => item[1]);

            // ã‚°ãƒ©ãƒ•ã®æç”»
            const ctx = document.getElementById('voteChart').getContext('2d');
            
            // ã™ã§ã«ã‚°ãƒ©ãƒ•ãŒã‚ã‚‹å ´åˆã¯ç ´æ£„ã—ã¦å†ä½œæˆ
            if (window.myChart) window.myChart.destroy();

            window.myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'å¾—ç¥¨æ•°',
                        data: values,
                        backgroundColor: 'rgba(0, 255, 65, 0.5)',
                        borderColor: '#00ff41',
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y', // æ¨ªæ£’ã‚°ãƒ©ãƒ•
                    scales: {
                        x: { beginAtZero: true, grid: { color: '#333' }, ticks: { color: '#00ff41' } },
                        y: { ticks: { color: '#00ff41' } }
                    },
                    plugins: { legend: { display: false } }
                }
            });

            document.getElementById('time').innerText = "æœ€çµ‚æ›´æ–°: " + new Date().toLocaleTimeString();
        } catch (e) {
            console.error("ãƒ‡ãƒ¼ã‚¿å–å¾—å¤±æ•—:", e);
        }
    }

    // åˆå›èª­ã¿è¾¼ã¿ã¨è‡ªå‹•æ›´æ–°ï¼ˆ30ç§’ãŠãï¼‰
    updateChart();
    setInterval(updateChart, 30000);
</script>
</body>
</html>
