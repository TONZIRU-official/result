<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤§æ±å·è­°ä¼šè­°å“¡ç·é¸æŒ™ é–‹ç¥¨é€Ÿå ±</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --main-color: #00ff41; --bg-color: #0d0d0d; }
        body { background-color: var(--bg-color); color: var(--main-color); font-family: 'Courier New', monospace; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { border: 2px solid var(--main-color); padding: 20px; width: 90%; max-width: 800px; background: rgba(0, 0, 0, 0.8); box-shadow: 0 0 15px rgba(0, 255, 65, 0.3); }
        h1 { border-bottom: 2px solid var(--main-color); padding-bottom: 10px; }
        canvas { margin-top: 20px; background: #111; padding: 10px; }
        .update-time { font-size: 0.8rem; color: #888; margin-top: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ“Š ç¬¬ä¸€å›å¤§æ±å·è­°ä¼šè­°å“¡ç·é¸æŒ™ é–‹ç¥¨é€Ÿå ±</h1>
    <p>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é›†è¨ˆã‚·ã‚¹ãƒ†ãƒ </p>
    
    <canvas id="voteChart"></canvas>
    
    <div id="time" class="update-time">æœ€çµ‚æ›´æ–°: èª­ã¿è¾¼ã¿ä¸­...</div>
</div>
<div id="admin-auth" style="margin-top: 50px; border-top: 1px dashed var(--main-color); padding-top: 20px;">
        <button id="show-panel-btn" onclick="document.getElementById('pass-input-area').style.display='block'; this.style.display='none';" style="background: none; color: #333; border: 1px solid #333; font-size: 0.7rem; cursor: pointer;">Admin Login</button>
        
        <div id="pass-input-area" style="display:none;">
            <input type="password" id="admin-pass" placeholder="Password" style="width:auto; border: 1px solid var(--main-color); background: #000; color: var(--main-color); padding: 5px;">
            <button onclick="loginAdmin()" style="padding: 5px 10px; background: var(--main-color); color: #000; font-weight: bold; border: none; cursor: pointer;">Login</button>
        </div>
    </div>

    <div id="flash-generator" style="display:none; margin-top: 20px; text-align: left; background: #111; padding: 15px; border: 1px solid var(--main-color);">
        <h3 style="font-size: 1rem; margin-top: 0;">ğŸ›  é€Ÿå ±ç”»åƒã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼</h3>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <input type="text" id="in-name" placeholder="å€™è£œè€…å">
            <input type="text" id="in-party" placeholder="æ”¿å…šå">
            <input type="number" id="in-votes" placeholder="å¾—ç¥¨æ•°">
            <button onclick="generateFlash()" style="background: #ff4100; color: white; border: none; font-weight: bold; cursor: pointer;">ç”»åƒã¨ã—ã¦ä¿å­˜</button>
        </div>
    </div>

    <div id="export-area" style="position: fixed; top: -1000px; width: 1200px; height: 630px; background: #000; color: #00ff41; padding: 40px; font-family: 'Courier New', monospace; border: 10px solid #00ff41; box-sizing: border-box;">
        <div style="font-size: 2rem; font-weight: bold; border-bottom: 2px solid #00ff41; padding-bottom: 10px; display: flex; justify-content: space-between;">
            <span>å¤§æ±å·è­°ä¼šè­°å“¡ç·é¸æŒ™ é€Ÿå ±</span>
            <span style="color: #fff; background: #cc0000; padding: 0 10px;">å½“ç¢º</span>
        </div>
        <div style="display: flex; align-items: center; margin-top: 60px; gap: 40px;">
            <div style="font-size: 10rem; border: 5px solid #00ff41; padding: 20px; line-height: 1;">å½“</div>
            <div style="flex-grow: 1;">
                <div id="out-name" style="font-size: 8rem; border-bottom: 3px solid #00ff41;">æ°å</div>
                <div id="out-party" style="font-size: 3rem; margin-top: 10px; color: #888;">æ”¿å…šå</div>
            </div>
        </div>
        <div style="text-align: right; margin-top: 30px;">
            <span style="font-size: 2rem;">å¾—ç¥¨æ•°:</span>
            <span id="out-votes" style="font-size: 5rem; font-weight: bold;">0</span>
            <span style="font-size: 2rem;"> ç¥¨</span>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <script>
        const SECRET_PASS = "daito2026"; // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¥½ããªã‚‚ã®ã«å¤‰ãˆã¦ãã ã•ã„

        function loginAdmin() {
            const pass = document.getElementById('admin-pass').value;
            if (pass === SECRET_PASS) {
                document.getElementById('flash-generator').style.display = 'block';
                document.getElementById('admin-auth').style.display = 'none';
            } else {
                alert("èªè¨¼å¤±æ•—");
            }
        }

        async function generateFlash() {
            const name = document.getElementById('in-name').value;
            const party = document.getElementById('in-party').value;
            const votes = document.getElementById('in-votes').value;

            if(!name || !votes) return alert("æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");

            document.getElementById('out-name').innerText = name;
            document.getElementById('out-party').innerText = party;
            document.getElementById('out-votes').innerText = Number(votes).toLocaleString();

            const exportArea = document.getElementById('export-area');
            html2canvas(exportArea).then(canvas => {
                const link = document.createElement('a');
                link.download = `é€Ÿå ±_${name}.png`;
                link.href = canvas.toDataURL();
                link.click();
            });
        }
    </script>
    
<script>
    const GAS_URL = "https://script.google.com/macros/s/AKfycbyfHXAuqwDIQ5Pi65RIvZ9QiAmqWgunOfPQt9lWHrzsfVcCX_BAQS2bSy17QPR6131P/exec"; 

    async function updateChart() {
        try {
            const response = await fetch(GAS_URL);
            const data = await response.json();
            const sortedData = Object.entries(data).sort((a, b) => b[1] - a[1]);
            const labels = sortedData.map(item => item[0]);
            const values = sortedData.map(item => item[1]);

            
            const ctx = document.getElementById('voteChart').getContext('2d');
            
            
            if (window.myChart) window.myChart.destroy();

            window.myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'å¾—ç¥¨æ•°',
                        data: values,
                        backgroundColor: 'rgba(0, 255, 65, 0.5)',
                        borderColor: '#00ff41',
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y', 
                    scales: {
                        x: { beginAtZero: true, grid: { color: '#333' }, ticks: { color: '#00ff41' } },
                        y: { ticks: { color: '#00ff41' } }
                    },
                    plugins: { legend: { display: false } }
                }
            });

            document.getElementById('time').innerText = "æœ€çµ‚æ›´æ–°: " + new Date().toLocaleTimeString();
        } catch (e) {
            console.error("ãƒ‡ãƒ¼ã‚¿å–å¾—å¤±æ•—:", e);
        }
    }

    
    updateChart();
    setInterval(updateChart, 30000);
</script>
</body>
</html>
